<div class="page">
    <%= render "devise/shared/navbar" %>

    <div class="search-page">
        <!-- Area superiore per la ricerca -->
        <div class="search-area">
            <div class="search-section">
                <div class="search-bar">
                    <div class="search-input">
                        <input type="text" placeholder="Search..." class="search-field">
                    </div>
                    <div class="search-divider"></div>
                    <div class="search-dropdown">
                        <select class="city-dropdown">
                            <option value="" disabled selected>Città...</option>
                            <option value="roma">Roma</option>
                            <option value="milano">Milano</option>
                            <option value="napoli">Napoli</option>
                        </select>
                    </div>
                    <button class="search-button">
                        <i class="fas fa-search"></i> 
                    </button>
                </div>
            </div>
        </div>

        <!-- Area inferiore con filtri ed eventi -->
        <div class="content-area">
            <!-- Colonna filtri -->
            <div class="filters-column">
                <h2 class="filters-title">Filtri</h2>

                <!-- Sezione Data -->
                <div class="filter-section">
                    <h3 class="filter-label">Data</h3>
                    <div class="filter-inputs">
                        <div class="input-group">
                            <label for="start-date">Da:</label>
                            <input type="date" id="start-date" name="start-date">
                        </div>
                        <div class="input-group">
                            <label for="end-date">A:</label>
                            <input type="date" id="end-date" name="end-date">
                        </div>
                    </div>
                </div>

                <!-- Sezione Prezzo -->
                <div class="filter-section">
                    <h3 class="filter-label">Prezzo</h3>
                    <div class="filter-inputs">
                        <div class="input-group">
                            <label for="min-price">Min:</label>
                            <input type="number" id="min-price" name="min-price" placeholder="€">
                        </div>
                        <div class="input-group">
                            <label for="max-price">Max:</label>
                            <input type="number" id="max-price" name="max-price" placeholder="€">
                        </div>  
                    </div>
                </div>

                <!-- Sezione Orario -->
                <div class="filter-section">
                    <h3 class="filter-label">Orario</h3>
                    <div class="filter-checkboxes">
                        <label><input type="checkbox" name="time" value="morning"> Mattina</label>
                        <label><input type="checkbox" name="time" value="afternoon"> Pomeriggio</label>
                        <label><input type="checkbox" name="time" value="evening"> Sera</label>
                    </div>
                </div>

                <!-- Sezione Categorie -->
                <div class="filter-section">
                    <h3 class="filter-label">Categorie</h3>
                    <div class="filter-checkboxes">
                        <label><input type="checkbox" name="category" value="adventure"> Adventure Travel</label>
                        <label><input type="checkbox" name="category" value="art"> Art Exhibitions</label>
                        <label><input type="checkbox" name="category" value="auctions"> Fundraisers</label>
                        <label><input type="checkbox" name="category" value="beer"> Festivals</label>
                        <label><input type="checkbox" name="category" value="benefit"> Concerts</label>
                    </div>
                    <a href="#" class="see-more-link">More</a>
                </div>
            </div>
    


            <!-- Sezione eventi -->
            <div class="main-content">
                <div class="events-grid">
                    <div class="event-card">
                        <div class="event-design">
                            <%= image_tag "card1.png", alt: "Event Image", class: "event-image" %>
                        </div>

                        <div class="event-frame">
                            <h3 class="event-title">THE MOTANS GEOGRAPHIC 2025</h3>
                            <p class="event-location">Orion Live Club</p>
                            <div class="event-date">
                                <span class="month">APR</span>
                                <span class="day">11</span>
                            </div>
                            <p class="event-time">8 PM</p>
                            <p class="event-price">Gratis</p>
                            
                            
                        </div>
                    </div>
                </div>
            </div> 

            <!-- Mappa -->
            <div class="map-area">
                <div id="map" style="width: 100%; height: 500px;"></div>
            </div>
            
            
            <script>    
                async function initMap() {
                    const { Map } = await google.maps.importLibrary("maps");
                    const { AdvancedMarkerElement } = await google.maps.importLibrary("marker");
                    const map = new Map(document.getElementById("map"), {
                        mapId: "74d5e23654ee93dd",
                        center: { lat: 41.9028, lng: 12.4964 }, // Default su Milano, cambia se necessario
                        zoom: 11
                    });
                    
                    var events = <%= raw @events.to_json(only: [:latitude, :longitude, :title]) %>;
                    console.log(events);

                    
                    events.forEach(function(event) {
                        console.log("Creazione marker per:", event);
                        if (event.latitude && event.longitude) {
                            const marker = new AdvancedMarkerElement({
                                map: map,
                                position: { lat: parseFloat(event.latitude), lng: parseFloat(event.longitude) },
                                title: event.title
                            });
                        } else {
                            console.warn("Evento senza coordinate valide:", event);
                        }
                    });
            
                }
                window.initMap = initMap;
            </script>

            <script async defer src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['GOOGLE_MAPS_API_KEY'] %>&map_ids=74d5e23654ee93dd&callback=initMap&v=beta"></script>-->
            
            <!--
            <% if @load_maps %>
                <%= javascript_include_tag "https://maps.googleapis.com/maps/api/js?key=AIzaSyAdKq-Tj_1Et_5zQNwiYwWLOQNJLdel-VA&v=beta&libraries=maps,marker&callback=initMap", async: true, defer: true %>
            <% end %>

            <script>
                async function initMap() {
                    const { Map } = await google.maps.importLibrary("maps");
                    const { AdvancedMarkerElement } = await google.maps.importLibrary("marker");

                    const map = new Map(document.getElementById("map"), {
                        center: { lat: 41.9028, lng: 12.4964 },
                        zoom: 11,
                        mapId: "74d5e23654ee93dd"
                    });

                    const events = <%= raw @events.to_json(only: [:latitude, :longitude, :title]) %>;
                    console.log("Eventi:", events);

                    events.forEach(event => {
                        if (event.latitude && event.longitude) {
                            new AdvancedMarkerElement({
                                map,
                                position: {
                                    lat: parseFloat(event.latitude),
                                    lng: parseFloat(event.longitude)
                                },
                                title: event.title
                            });
                            console.log(`Marker creato: ${event.title} alle coordinate (${event.latitude}, ${event.longitude})`);
                        } else {
                            console.warn("Evento senza coordinate valide:", event);
                        }
                    });
                }

                window.onload = () => {
                    if (typeof google !== "undefined" && google.maps) {
                        initMap();
                    } else {
                        console.error("Google Maps non è stato caricato correttamente.");
                    }
                };
            </script>-->
           
        </div>
    </div>
    <%= render "devise/shared/footer" %>
</div>